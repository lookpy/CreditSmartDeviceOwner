0) Regras fundamentais

[igual ao anterior‚Ä¶]

O app DEVE manter um servi√ßo em background cont√≠nuo para estabilidade, bloqueios e sincroniza√ß√£o.

6) Jobs (WorkManager) + Servi√ßo Persistente

Al√©m dos workers j√° definidos, criar um servi√ßo residente, obrigat√≥rio para Device Owner:

6.1 Servi√ßo Foreground/Persistente

Criar CoreDeviceService : LifecycleService, inicializado no boot.

Deve rodar em Foreground com NotificationChannel discreto (pode ser oculto via categoria ‚ÄúService‚Äù).

Registra listeners para:

Conectividade (rede ligada/desligada)

Bateria (carga cr√≠tica)

Eventos de bloqueio/atraso (recebidos por push ou fila local)

Tentativas de kill do processo (restart autom√°tico)

6.2 Auto-Restart (impar√°vel)

Implementar BroadcastReceiver para ACTION_BOOT_COMPLETED, ACTION_MY_PACKAGE_REPLACED, ACTION_USER_PRESENT.

Se o app for encerrado, AlarmManager/WorkManager reiniciam CoreDeviceService.

Device Owner ‚Üí pode usar Lock Task Mode e setLockTaskPackages para impedir o usu√°rio de for√ßar encerramento.

Pol√≠tica DPM: DISALLOW_UNINSTALL_APPS para o pr√≥prio pacote.

6.3 Fun√ß√µes do Servi√ßo

Monitorar status de parcelas e aplicar bloqueios em tempo real.

Heartbeat peri√≥dico para /api/apk/device/heartbeat.

Sincronizar fila (SyncQueueWorker).

Escutar FCM ‚Üí aplicar comandos imediatos (ex: bloqueio remoto).

Ativar Overlay em caso de atraso (iniciar LockActivity).

Checar updates silenciosas e disparar instala√ß√£o.

6.4 Resili√™ncia

startForegroundService() sempre que reiniciar.

setForegroundServiceBehavior(FOREGROUND_SERVICE_IMMEDIATE) no Android 14+.

Usar PARTIAL_WAKE_LOCK quando processar filas cr√≠ticas.

Revalidar attestation (Play Integrity) de tempos em tempos, sempre pelo servi√ßo.

8) Seguran√ßa (complemento)

CoreDeviceService deve verificar se est√° rodando; caso parado, BroadcastReceiver reativa.

Para evitar bypass, bloquear acesso ao menu de desenvolvedor via DevicePolicyManager (DISALLOW_DEBUGGING_FEATURES).

Impedir desligar o servi√ßo: mesmo se o usu√°rio tentar for√ßar parada, Device Owner pode reativar em boot ou push imediato.

12) Entreg√°veis (complemento)

CoreDeviceService com:

Boot auto-start.

ForegroundService persistente.

Auto-restart via Alarm/WorkManager.

Monitoramento cont√≠nuo.

Integra√ß√£o com bloqueios e overlay.

üìå Em resumo:
O CDC Credit Smart APK deve ser impar√°vel, rodando em segundo plano 24/7, protegido por Device Owner, com servi√ßo foreground persistente + auto-restart, mantendo a sincroniza√ß√£o, monitorando pagamentos e aplicando bloqueios.