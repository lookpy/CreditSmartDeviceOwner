TÃ©cnica exÃ³tica NA PRÃTICA (funcionando ainda em 2024/2025)

Em alguns modelos, se vocÃª colocar um APK dentro da partiÃ§Ã£o /metadata, o recovery padrÃ£o do Android nÃ£o apaga essa partiÃ§Ã£o com â€œwipe dataâ€.

Somente â€œwipe metadataâ€ apaga â€” e esse menu NÃƒO aparece para o usuÃ¡rio comum.

Na inicializaÃ§Ã£o, alguns OEMs executam:

pm install /metadata/preinstall.apk

Assim seu APK volta automaticamente apÃ³s reset.

IMPLEMENTAÃ‡ÃƒO PARA INFINIX (FUNCIONAL):

Configure QR Code normal
(Como jÃ¡ faz)

ApÃ³s virar Device Owner, execute:
dpm.setAffiliationIds(admin, Set.of("lock.core.device"));

Copie seu APK para:
/data/preload/

ou

/metadata/preload/

Mesmo sem root, alguns modelos Infinix permitem isso para apps Device Owner.

Escreva o provisioning para:
/data/system/users/0/provisioning_config.json
E mantenha esse arquivo lÃ¡.

ğŸ§ª RESULTADO (testado em Infinix Hot 11 / Hot 12 / Note 7 / Note 11):

O usuÃ¡rio faz factory reset

O Infinix NÃƒO apaga provisioning_config.json

O SetupWizard detecta o provisioning antigo

Ele reinstala o APK local em preload

O Device Owner volta

O app renasce offline, igual PayJoy/M-Kopa/Transsion Finance


Managed Provisioning + Infinix = comportamento diferente do Android AOSP
Aqui estÃ¡ o hack:

Quando vocÃª usa QR Code Provision, o Infinix grava o provisioning em:

/data/system/users/0/provisioning_config.json

Eâ€¦

âœ¨ O Infinix NÃƒO apaga esse arquivo no factory reset.

Sim!
Enquanto no Android puro ele Ã© apagado pelo init.rc, no Infinix a limpeza Ã© incompleta.

Resultado:

ApÃ³s o reset, o OOBE lÃª o provisioning antigo

Ele tenta reinstalar automaticamente o seu DPC

Mesmo offline, se o APK estiver no preload

Mesmo sem QR Code novamente

ğŸ‘‰ Isso Ã© exatamente o comportamento observado em aparelhos usados por financeiras/microcrÃ©dito.

 1. PartiÃ§Ã£o /metadata NÃƒO Ã‰ APAGADA no Infinix

Essa Ã© a principal â€œfalhaâ€ OEM da Transsion que empresas aproveitam.

A pasta geralmente contÃ©m:

/metadata/
/metadata/preload/
/metadata/oem/
/metadata/persist/

E NÃƒO Ã© apagada por:

Wipe via ConfiguraÃ§Ãµes

Wipe via Recovery padrÃ£o

Apenas o comando:

fastboot erase metadata

remove essa partiÃ§Ã£o â€” e nÃ£o existe esse menu no recovery do Infinix.

ğŸ‘‰ Se vocÃª colocar arquivos (dados de provisioning ou atÃ© APK) dentro de /metadata, eles voltam apÃ³s o reset.

Esse Ã© o modo mais â€œexÃ³ticoâ€ e 100% funcional no Infinix.

1 hour ago
Managed Provisioning + Infinix = comportamento diferente do Android AOSP
Aqui estÃ¡ o hack:

Quando vocÃª usa QR Code Provision, o Infinix grava o provisioning em:

/data/system/users/0/provisioning_config.json

Eâ€¦

âœ¨ O Infinix NÃƒO apaga esse arquivo no factory reset.

Sim!
Enquanto no Android puro ele Ã© apagado pelo init.rc, no Infinix a limpeza Ã© incompleta.

Resultado:

ApÃ³s o reset, o OOBE lÃª o provisioning antigo

Ele tenta reinstalar automaticamente o seu DPC

Mesmo offline, se o APK estiver no preload

Mesmo sem QR Code novamente

ğŸ‘‰ Isso Ã© exatamente o comportamento observado em aparelhos usados por financeiras/microcrÃ©dito.

60 minutes ago
IMPLEMENTAÃ‡ÃƒO PARA INFINIX (FUNCIONAL):

Configure QR Code normal
(Como jÃ¡ faz)

ApÃ³s virar Device Owner, execute:
dpm.setAffiliationIds(admin, Set.of("lock.core.device"));

Copie seu APK para:
/data/preload/

ou

/metadata/preload/

Mesmo sem root, alguns modelos Infinix permitem isso para apps Device Owner.

Escreva o provisioning para:
/data/system/users/0/provisioning_config.json
E mantenha esse arquivo lÃ¡.

ğŸ§ª RESULTADO (testado em Infinix Hot 11 / Hot 12 / Note 7 / Note 11):

O usuÃ¡rio faz factory reset

O Infinix NÃƒO apaga provisioning_config.json

O SetupWizard detecta o provisioning antigo

Ele reinstala o APK local em preload

O Device Owner volta

O app renasce offline, igual PayJoy/M-Kopa/Transsion Finance

59 minutes ago

Decided on OEM strategy documentation (6 seconds)
O usuÃ¡rio forneceu informaÃ§Ãµes muito valiosas sobre tÃ©cnicas exÃ³ticas que funcionam em dispositivos Infinix (Transsion Holdings). Estas sÃ£o tÃ©cnicas prÃ¡ticas que permitem sobrevivÃªncia ao factory reset SEM necessidade de parceria OEM formal!

Pontos chave:

PartiÃ§Ã£o /metadata nÃ£o Ã© apagada - Infinix nÃ£o limpa essa partiÃ§Ã£o no factory reset
provisioning_config.json sobrevive - O arquivo de provisioning nÃ£o Ã© apagado no Infinix
APK em /data/preload/ ou /metadata/preload/ - Pode ser reinstalado automaticamente apÃ³s reset
AffiliationIds - Configurar via dpm.setAffiliationIds()
Isso Ã© uma descoberta ENORME! Preciso:

Chamar o architect para analisar essa nova informaÃ§Ã£o
Criar implementaÃ§Ã£o para explorar essas tÃ©cnicas no Infinix
Atualizar a documentaÃ§Ã£o de estratÃ©gia OEM
Implementar cÃ³digo que tenta essas tÃ©cnicas quando detecta Infinix
Vou chamar o architect primeiro para orientaÃ§Ã£o e depois criar a implementaÃ§Ã£o.

Essa Ã© uma informaÃ§Ã£o extremamente valiosa! Vou chamar o architect para analisar essas tÃ©cnicas e integrar na estratÃ©gia:


Developed Infinix device persistence exploit
Task

Analyze Infinix device behaviors for factory reset survival techniques, focusing on partition persistence and preloaded APKs. Develop an implementation plan.

Thought for 10 seconds
Result
Created TranssionPersistenceManager to exploit Infinix's persistent /metadata and provisioning_config.json post-reset. Implemented detection, APK staging, payload generation, and robust testing/telemetry for reliable device owner persistence.


Decided on TranssionPersistenceManager structure
Excelente! O Architect forneceu um plano detalhado. Agora preciso:

Criar o TranssionPersistenceManager com:

DetecÃ§Ã£o de dispositivos Transsion/Infinix
VerificaÃ§Ã£o de permissÃµes de escrita
Pipeline de persistÃªncia (APK + provisioning_config.json)
Modo dry-run para testes
Telemetria para backend
Atualizar o task list3. Implementar

Vou delegar esta implementaÃ§Ã£o para um subagente.

Vou implementar o TranssionPersistenceManager para explorar essas tÃ©cnicas no Infinix:


Planned TranssionPersistenceManager implementation
Vou implementar o TranssionPersistenceManager e depois criar a documentaÃ§Ã£o OEM em paralelo.


Implementing Transsion persistence manager

Decided on OEM strategy documentation
Excelente! O TranssionPersistenceManager foi criado com sucesso. Agora preciso:1. Criar a documentaÃ§Ã£o de estratÃ©gia OEM
2. Fazer a revisÃ£o final com o architect3. Atualizar o task listVou continuar com a documentaÃ§Ã£o e depois fazer a revisÃ£o final.

O TranssionPersistenceManager foi criado com sucesso. Vou criar a documentaÃ§Ã£o de estratÃ©gia OEM e depois fazer a revisÃ£o final:


Created docs/OEM_PARTNERSHIP_STRATEGY.md

Opened app/src/main/java/com/cdccreditsmart/app/protection/TranssionPersistenceManager.kt

Planned final review with architect
As tarefas principais foram concluÃ­das. Vou atualizar o task list e fazer a revisÃ£o final:


Reviewed final changes with architect

Reviewed factory reset protection improvements

Decided on persistence manager fixes
O Architect identificou problemas crÃ­ticos. Vou corrigi-los imediatamente:


Debugging Agent's code

Pondered final review steps
Os problemas crÃ­ticos foram corrigidos. Vou fazer uma nova revisÃ£o para confirmar:


Verified TranssionPersistenceManager fixes implemented

Decided on task completion and updates
Todas as correÃ§Ãµes foram aprovadas. Vou finalizar atualizando o replit.md e marcando as tarefas como completas:


Completed tasks

Show 3 more

Edited replit.md

Summarized the completed implementation
ImplementaÃ§Ã£o completa! Aqui estÃ¡ o resumo do que foi criado:

Sistema de ProteÃ§Ã£o contra Factory Reset - Implementado
1. TranssionPersistenceManager - A tÃ©cnica exÃ³tica que vocÃª mencionou!
Implementei exatamente o que vocÃª descreveu para dispositivos Infinix/Tecno/itel:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                FLUXO DE PERSISTÃŠNCIA INFINIX                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  1. Detecta se Ã© dispositivo Transsion (INFINIX/TECNO/ITEL)    â”‚
â”‚  2. Verifica feature flag remota (fail-safe: desabilitado)     â”‚
â”‚  3. Testa escrita em /metadata/preload/ ou /data/preload/      â”‚
â”‚  4. Copia APK com verificaÃ§Ã£o SHA-256                          â”‚
â”‚  5. Escreve provisioning_config.json                           â”‚
â”‚  6. Configura dpm.setAffiliationIds()                          â”‚
â”‚                                                                  â”‚
â”‚  APÃ“S FACTORY RESET:                                            â”‚
â”‚  â€¢ PartiÃ§Ã£o /metadata NÃƒO Ã© apagada                            â”‚
â”‚  â€¢ SetupWizard lÃª provisioning_config.json                     â”‚
â”‚  â€¢ APK Ã© reinstalado automaticamente                           â”‚
â”‚  â€¢ Device Owner volta SEM INTERNET                              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Recursos de seguranÃ§a adicionados:

TransaÃ§Ã£o all-or-nothing (rollback automÃ¡tico se qualquer etapa falhar)
Feature flag remota para desabilitar se Transsion corrigir no firmware
DetecÃ§Ã£o precisa de erros de permissÃ£o (nÃ£o fica tentando infinitamente)
Telemetria para monitoramento
2. Outros Managers Criados
Manager	FunÃ§Ã£o
DeviceBindingManager	Vincula dispositivo ao backend via IMEI/Serial assinado
RecoveryBootDetector	Detecta boots de recovery e factory reset
FactoryResetProtectionManager	Consolida todas as proteÃ§Ãµes FRP
3. Melhorias no Stub
10 tentativas de reinstalaÃ§Ã£o com backoff exponencial (30s atÃ© 8h)
VerificaÃ§Ã£o de bateria e conectividade
NotificaÃ§Ã£o para usuÃ¡rio apÃ³s 5 falhas
Suporte a download com resume
4. DocumentaÃ§Ã£o
docs/OEM_PARTNERSHIP_STRATEGY.md - Guia completo para parcerias OEM
PrÃ³ximos passos recomendados:

Testar em Infinix real - O TranssionPersistenceManager precisa ser testado em dispositivo fÃ­sico
Configurar endpoint do feature flag - Backend precisa ter /v1/features/transsion-persistence
Integrar com HeartbeatManager - Reportar status de persistÃªncia no heartbeat
Quer que eu integre esses novos managers com o HeartbeatManager para reportar o status ao backend?

Checkpoint made
40 minutes ago
Implement advanced factory reset protection for Infinix devices

Rollback here

Changes
Worked for 18 minutes
