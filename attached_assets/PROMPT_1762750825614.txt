Rotas de Bloqueio do APK
üîê Endpoints APK (Para o App Android)
1. Comandos MDM
Buscar Comandos Pendentes
GET /api/apk/device/{serialNumber}/commands

Autentica√ß√£o: Play Integrity (autom√°tico)
Uso: APK consulta comandos pendentes a cada 30-60 segundos (polling)
Response: Lista de comandos pendentes (bloqueio/desbloqueio)
Enviar Resposta de Comando
POST /api/apk/device/{serialNumber}/command-response

Autentica√ß√£o: Play Integrity (autom√°tico)
Uso: APK confirma execu√ß√£o do comando (sucesso ou falha)
Body:
{
  "commandId": "cmd_uuid_123",
  "status": "completed|failed|acknowledged",
  "response": {
    "success": true,
    "blockedAppsCount": 15,
    "appliedLevel": 2
  }
}

2. Sistema de Decis√µes Pendentes
Buscar Decis√µes Pendentes
GET /api/apk/device/{serialNumber}/pending-decisions

Autentica√ß√£o: Play Integrity (autom√°tico)
Uso: Verificar decis√µes administrativas de bloqueio
Response: Lista de decis√µes pendentes
Confirmar Decis√£o Processada
POST /api/apk/device/{serialNumber}/acknowledge-decision

Autentica√ß√£o: Play Integrity (autom√°tico)
Uso: Confirmar que a decis√£o foi processada
Body:
{
  "decisionId": "decision_uuid_456",
  "response": {
    "success": true,
    "processedAt": "2025-11-10T12:05:00.000Z"
  }
}

3. Desbloqueio de Dispositivo
Desbloquear Dispositivo
POST /api/apk/device/{serialNumber}/unblock

Autentica√ß√£o: Play Integrity (autom√°tico)
Uso: APK solicita desbloqueio (ap√≥s pagamento regularizado)
Response:
{
  "success": true,
  "serialNumber": "ABC123456",
  "deviceId": "device_xxx",
  "isBlocked": false
}

4. Bloqueio Legado (Compatibilidade)
Bloquear Dispositivo (Legado)
POST /api/apk/device/{serialNumber}/block

Status: DEPRECATED
Uso: Manter compatibilidade com vers√µes antigas do APK
Recomenda√ß√£o: Usar sistema de comandos MDM acima
üñ•Ô∏è Endpoints Admin (Painel Web)
1. Bloqueio Progressivo Manual
For√ßar N√≠vel de Bloqueio
POST /api/devices/{deviceId}/progressive-block

Autentica√ß√£o: JWT (Admin apenas)
Uso: Administrador for√ßa um n√≠vel espec√≠fico (0-5)
Body:
{
  "targetLevel": 2,
  "manualOverride": true
}

Obter N√≠vel Atual
GET /api/devices/{deviceId}/block-level

Autentica√ß√£o: JWT
Response:
{
  "deviceId": "device_xxx",
  "currentLevel": 2,
  "daysOverdue": 15,
  "suggestedLevel": 2
}

Obter N√≠veis de Todos Dispositivos
GET /api/devices/block-levels

Autentica√ß√£o: JWT
Response: Array com n√≠veis de todos os dispositivos da loja
2. Bloqueio/Desbloqueio Simples
Bloquear Dispositivo
POST /api/devices/{deviceId}/block

Autentica√ß√£o: JWT
Uso: Bloqueio total do dispositivo (n√£o progressivo)
Desbloquear Dispositivo
POST /api/devices/{deviceId}/unblock

Autentica√ß√£o: JWT
Uso: Desbloqueio total do dispositivo
üîÑ WebSocket (Tempo Real)
Notifica√ß√µes de Comandos MDM
wss://{servidor}/ws?token={jwtToken}

Evento: NEW_COMMAND
Payload: Comando de bloqueio/desbloqueio em tempo real
Uso: APK recebe comandos instantaneamente sem polling
üìä Resumo de Uso
APK Android (Kotlin)
Polling: GET /api/apk/device/{serial}/commands (a cada 30-60s)
Acknowledgement: POST /api/apk/device/{serial}/command-response
WebSocket: Conectar em /ws para receber comandos em tempo real
Painel Admin (Web)
Bloqueio Manual: POST /api/devices/{id}/progressive-block
Consulta: GET /api/devices/{id}/block-level
Monitoramento: GET /api/devices/block-levels
Todas as rotas APK (/api/apk/device/...) usam Play Integrity automaticamente - n√£o precisam de token JWT nos headers! üîê