PROMPT REVISADO ‚Äì ‚ÄúCDC Credit Smart ‚Äì App Kotlin (Device Owner)‚Äù
0) Objetivo

Construir um app Android (Kotlin) para clientes do CDC Credit Smart que:

Opera como Device Owner (Android Enterprise) ‚Äî a instala√ß√£o via QR Code √© feita pelo Android nativo e n√£o pelo app.

Ap√≥s o provisionamento, o app inicia com privil√©gios de DevicePolicyManager para aplicar as pol√≠ticas necess√°rias.

Implementa o fluxo de valida√ß√£o do cliente (atestado, biometria, assinatura, sincroniza√ß√£o).

Permite o cliente acompanhar parcelas, efetuar pagamentos (PIX, boleto), receber push de cobran√ßa, e aplica bloqueios graduais at√© overlay total em caso de inadimpl√™ncia.

Possui banco de dados offline (Room), fila de sincroniza√ß√£o (WorkManager), atualiza√ß√µes silenciosas (Device Owner).

Segue tema visual CDC Credit Smart (dark + laranja).

√â fluido, seguro, anti-tamper e resistente a engenharia reversa.

1) Arquitetura & Tech Stack

Linguagem: Kotlin (minSdk 26+).

UI: Jetpack Compose + Material 3.

Arquitetura: Clean + MVVM.

Persist√™ncia: Room + EncryptedSharedPreferences.

Networking: Retrofit + OkHttp (TLS 1.3 + Certificate Pinning).

Jobs: WorkManager (retries + backoff).

Push: Firebase Cloud Messaging.

Assinatura: https://github.com/gcacace/android-signaturepad
 (via ViewInterop no Compose).

Ofusca√ß√£o: R8/ProGuard + checks anti-tamper.

2) Cores e UI

Background: #121212

Cards: #1E1E1E

Prim√°ria (CDC Laranja): #FF7A1A

Secund√°ria: #F47C2C

Texto: Branco (#FFFFFF) e cinza claro (#CFCFCF)

Sucesso: Verde (#4CAF50)

Erro: Vermelho (#E53935)

3) Fluxo Ajustado do App
Importante: N√£o implementar QR Code no app.

O Android nativo faz o provisionamento via QR ‚Üí instala o app ‚Üí define-o como Device Owner.

O app come√ßa a rodar ap√≥s essa instala√ß√£o.

Fluxo dentro do app:

Tela Boas-vindas ‚Üí anima√ß√£o CDC ‚Üí ‚ÄúConfigurar Dispositivo‚Äù.

Atestado (/v1/device/attest) ‚Üí valida IMEI digitado √ó IMEI real.

Bind contrato‚Äìdispositivo (/v1/device/bind).

Biometria facial + liveness (/v1/biometry/face/verify).

Assinatura digital (SignaturePad + /v1/contract/sign).

Sincroniza√ß√£o final (/v1/contract/sync).

Dashboard: parcelas, pagamentos, status do contrato.

Parcelas/Pagamento: PIX (gera QR copia e cola) / Boleto (PDF/link).

Perfil: dados pessoais + informa√ß√µes do dispositivo + contrato.

Suporte: FAQ, WhatsApp, abertura de chamado.

Bloqueio (overlay): bloqueio parcial ou total conforme atraso.

Atualiza√ß√µes silenciosas: baixadas e instaladas via APIs de Device Owner.

4) Device Owner ‚Äì Pol√≠ticas

Quem define Device Owner √© o Android, n√£o o app.

O app s√≥ consome APIs do DevicePolicyManager:

Bloqueio de apps (setPackagesSuspended).

Lock task mode (setLockTaskPackages).

Restri√ß√µes: DISALLOW_FACTORY_RESET, DISALLOW_USB_FILE_TRANSFER, DISALLOW_DEBUGGING_FEATURES.

Atualiza√ß√µes silenciosas (installPackage).

Overlay de bloqueio em tela cheia (Activity lock task).

5) Banco Offline (Room)

Installments, Payments, DeviceBinding, BiometrySessions, SyncQueue, AuditLog, Terms, Flags.

Estrat√©gia: grava local ‚Üí envia via WorkManager ‚Üí reprocessa se falhar.

6) APIs ‚Äì Integra√ß√£o

Rotas usadas pelo app (p√≥s-provisionamento):

/v1/device/attest

/v1/device/bind

/v1/biometry/face/verify

/v1/contract/terms

/v1/contract/sign

/v1/contract/sync

/api/apk/device/installments

/api/apk/device/{serial}/pay/{installmentId}

/api/apk/device/heartbeat

/api/android/updates/check

/api/android/updates/download

7) Seguran√ßa

JWT curto (15 min) com escopos.

Refresh Token rotativo no Keystore.

Assinatura de requisi√ß√£o (X-Device-Signature).

Idempotency-Key em POSTs.

Verifica√ß√£o Play Integrity / Key Attestation di√°ria.

Root / emulador / debugger detection.

8) UX

Jetpack Compose com stepper visual (Atestado ‚Üí Biometria ‚Üí Assinatura ‚Üí Conclu√≠do).

Feedback imediato em cada etapa (spinner ‚Üí check verde ‚Üí erro em vermelho).

Offline-first: sempre mostra status local, sincroniza quando poss√≠vel.

Overlay de bloqueio com bot√£o ‚ÄúPagar agora‚Äù direto para tela de pagamento.

9) O que N√ÉO implementar

QR Code de provisionamento.

Esse fluxo pertence ao Android Enterprise e ocorre fora do app.

O app n√£o cria, l√™ ou processa QR.

Ele apenas assume papel de Device Owner depois que o Android instala via QR.

üëâ Resumindo para a IA:

‚ÄúImplemente o app Kotlin como Device Owner, mas n√£o desenvolva nada de QR Code dentro dele. O QR Code √© do Android nativo no provisionamento. O app s√≥ come√ßa a atuar ap√≥s o provisionamento, cuidando do fluxo de valida√ß√£o, pagamentos, parcelas, suporte e bloqueio.‚Äù