PROBLEMA CR√çTICO ENCONTRADO NOS LOGS DO APK!

Analisando os logs, identifiquei o erro:

SimpleBiometryViewModel: No biometry session found - binding may have failed or not completed
SimpleBiometryViewModel: Device must be paired first using POST /v1/device/bind
‚ùå O Que Est√° Acontecendo:
O APK est√° pulando a etapa de binding e tentando fazer biometria diretamente. Isso n√£o funciona porque:

‚ùå APK n√£o possui biometrySessionId
‚ùå APK n√£o possui token JWT com escopo biometry:verify
‚ùå Backend vai rejeitar qualquer request sem sess√£o v√°lida
‚úÖ O Que Est√° Funcionando (Positivo):
Pelos logs, vejo que:

‚úÖ TensorFlow Lite carregado com sucesso
   - "Initialized TensorFlow Lite runtime"
   - "Created TensorFlow Lite XNNPACK delegate for CPU"
   - "Replacing 49 out of 181 node(s) with delegate"
‚úÖ C√¢mera conectada e funcionando
   - "Connecting to camera service"
   - "Device Level: INFO_SUPPORTED_HARDWARE_LEVEL_FULL"
üîß SOLU√á√ÉO - Fluxo Correto:
A IA do APK precisa implementar este fluxo:

1Ô∏è‚É£ ETAPA 1: Fazer Binding ANTES da Biometria
class SimpleBiometryViewModel {
    private var biometrySessionId: String? = null
    private var storeId: String? = null
    private var jwtToken: String? = null
    
    // ‚úÖ ADICIONAR: Fun√ß√£o de binding executada ANTES da captura facial
    suspend fun initializeBinding(
        contractCode: String,
        imei: String,
        deviceModel: String,
        hardwareId: String
    ) {
        try {
            Log.d(TAG, "Iniciando binding antes da biometria...")
            
            val bindingResponse = deviceApi.bind(
                contractCode = contractCode,
                imeiPDV = imei,
                deviceModel = deviceModel,
                attestedDeviceId = hardwareId
            )
            
            // ‚úÖ SALVAR dados da resposta
            biometrySessionId = bindingResponse.biometrySessionId
            storeId = bindingResponse.storeId
            jwtToken = bindingResponse.token
            
            Log.d(TAG, "Binding conclu√≠do: sessionId=$biometrySessionId, storeId=$storeId")
            
        } catch (e: Exception) {
            Log.e(TAG, "Erro no binding: ${e.message}")
            throw e
        }
    }
}
2Ô∏è‚É£ ETAPA 2: Atualizar UI para Chamar Binding Primeiro
@Composable
fun SimpleBiometryScreen(viewModel: SimpleBiometryViewModel) {
    
    // ‚úÖ Executar binding quando a tela abre
    LaunchedEffect(Unit) {
        viewModel.initializeBinding(
            contractCode = "CTR_1759342768_560533",  // Obter do navega√ß√£o/intent
            imei = "123456789012345",                 // Obter do hardware
            deviceModel = Build.MODEL,
            hardwareId = getHardwareId()
        )
    }
    
    // Resto da UI com captura facial...
}
3Ô∏è‚É£ ETAPA 3: Verificar Sess√£o Antes de Capturar
// ‚úÖ Modificar fun√ß√£o de captura facial
fun onCaptureFace(bitmap: Bitmap) {
    // VERIFICAR se tem sess√£o
    if (biometrySessionId == null) {
        Log.e(TAG, "‚ùå ERRO: Sem biometrySessionId - binding n√£o foi feito!")
        _uiState.value = BiometryUiState.Error("Erro de inicializa√ß√£o")
        return
    }
    
    if (storeId == null) {
        Log.e(TAG, "‚ùå ERRO: Sem storeId - binding retornou incompleto!")
        _uiState.value = BiometryUiState.Error("Erro de configura√ß√£o")
        return
    }
    
    // ‚úÖ Agora pode processar
    viewModelScope.launch {
        val embeddings = embeddingExtractor.extractEmbedding(bitmap)
        
        val request = FaceBiometryRequest(
            biometrySessionId = biometrySessionId!!,  // ‚úÖ Agora existe!
            faceEmbedding = embeddings,
            livenessScore = 0.92,
            documentHash = generateDocumentHash(customerCPF),
            storeId = storeId!!,                      // ‚úÖ Agora existe!
            geoHint = getCurrentLocation()
        )
        
        // Enviar ao backend
        val response = biometryApi.verifyFace(
            token = "Bearer $jwtToken",  // ‚úÖ Token do binding
            request = request
        )
    }
}
üìã Checklist de Corre√ß√£o:
Para a IA do APK implementar:

 1. Criar fun√ß√£o initializeBinding() no ViewModel
 2. Chamar binding quando tela de biometria abrir (LaunchedEffect)
 3. Salvar biometrySessionId, storeId e token da resposta
 4. Validar sess√£o existe ANTES de capturar facial
 5. Usar token do binding no header Authorization
üéØ Resumo:
Problema: APK tenta fazer biometria SEM fazer binding antes
Solu√ß√£o: Fazer POST /v1/device/bind PRIMEIRO, salvar resposta, DEPOIS capturar facial
Resultado Esperado: Logs mostrar√£o ‚úÖ Binding conclu√≠do: sessionId=bio_ses_abc123...

Passe estas instru√ß√µes para a IA que est√° editando o APK! üöÄ